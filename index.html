<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact Book</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Contact Book</h1>
            <div class="actions">
                <button id="refresh" class="btn" type="button">Refresh</button>
                <button id="addContact" class="btn" type="button">Add Contact</button>
            </div>
        </div>
        
        <div id="table">Loading contacts...</div>
    </div>

    <script src="config.js"></script>
    <script>
        document.getElementById("refresh").addEventListener('click', fetchContacts);
        document.getElementById("addContact").addEventListener('click', addContact);

        function fetchContacts(){
            document.getElementById("table").innerHTML = "Loading contacts...";
            fetch(rootPath + "controller/get-contacts/")
            .then(function(response){
                return response.json();
            })
            .then(function(data){
                displayOutput(data);
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById("table").innerHTML = "Failed to load contacts. Please try again.";
            });
        }

        function displayOutput(data){
            let output = "<table>";
            output += `<thead><tr><th>Photo</th><th>First Name</th><th>Last Name</th></tr></thead><tbody>`;

            for(a in data){
                output += `
                    <tr onclick="editContact(${data[a].id})">
                        <td><img src="${rootPath}controller/uploads/${data[a].avatar}" class="contact-avatar" onerror="this.src='https://ui-avatars.com/api/?name=${data[a].firstname}+${data[a].lastname}&background=666&color=fff'"/></td>
                        <td>${data[a].firstname}</td>
                        <td>${data[a].lastname}</td>
                    </tr>
                `;
            }
            output += "</tbody></table>";
            document.getElementById("table").innerHTML = output;
        }
        
        function addContact(){
            window.open("add-contact.html", "_self");
        }

        function editContact(id){
            window.open(`edit-contact.html?id=${id}`, "_self");
        }

        // Load contacts on page load
        fetchContacts();
    </script>
</body>
</html>